(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{410:function(t,a,s){t.exports=s.p+"assets/img/webpackrun1.0b7bb7b7.jpg"},411:function(t,a,s){t.exports=s.p+"assets/img/webpackrunchain.5a6ff422.jpg"},463:function(t,a,s){"use strict";s.r(a);var n=s(2),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"webpack的运行流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack的运行流程"}},[t._v("#")]),t._v(" webpack的运行流程")]),t._v(" "),a("p",[t._v("webpack运行流程即把各个模块串联的流程")]),t._v(" "),a("ol",[a("li",[t._v("初始化：配置文件读取合并参数，初始化插件和对应环境")]),t._v(" "),a("li",[t._v("编译构建：从Entry发出，针对每个串行的Module调用Loader翻译（加载），并按照依赖关系递归编译")]),t._v(" "),a("li",[t._v("输出：编译后将Module组合成Chunk，Chunk转化为文件")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(410),alt:""}})]),t._v(" "),a("h3",{attrs:{id:"初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[t._v("#")]),t._v(" 初始化")]),t._v(" "),a("p",[t._v("配置文件默认为"),a("code",[t._v("webpack.config.js")]),t._v(" ，功能是激活webpack加载项和插件")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" node_modules "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_modules'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ath.resolve([…paths])里的每个参数都类似在当前目录执行一个cd操作，从左到右执行，")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" pathToReact "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node_modules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react/dist/react.min.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//入口文件，模块构造的起点，每一个入口文件对应最后生成的Chunk，即最后生成的模块的带引用依赖的集合")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("entry")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./path/to/my/entry/file.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//文件路径指向")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("alias")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'react'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("pathToReact\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//生成文件，是模块构筑的终点。包括输出文件与输出路径")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("output")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].js'")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//配置loader，设置文件后缀和对应的首处理loader以及备用处理loader")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("module")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loaders")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loader")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'babel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("presets")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es2015'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("noParse")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("pathToReact"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//webpack各个插件对象，，在webpack事件流中执行对应方法")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("Plugins")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("webpack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HotModuleReplacementPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("webpack将"),a("code",[t._v("webpack.config.js")]),t._v("的配置拷贝到options对象中，并加载用户配置的plugins")]),t._v(" "),a("p",[t._v("之后开始初始化"),a("strong",[t._v("compiler")]),t._v("编译对象，其中包含了"),a("strong",[t._v("钩子函数")]),t._v("若干，继承自"),a("strong",[t._v("Tapable")])]),t._v(" "),a("h3",{attrs:{id:"编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[t._v("#")]),t._v(" 编译")]),t._v(" "),a("p",[t._v("根据"),a("code",[t._v("webpack.config.js")]),t._v("的"),a("code",[t._v("entry")]),t._v("找出所有出口文件")]),t._v(" "),a("p",[t._v("初始化完成后会调用"),a("code",[t._v("Compiler")]),t._v("的"),a("code",[t._v("run")]),t._v("来真正启动编译构建流程，包括了编译与输出")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("compile")]),t._v("开始编译")]),t._v(" "),a("li",[a("code",[t._v("make")]),t._v("从入口分析模块以及模块依赖关系，创建模块对象")]),t._v(" "),a("li",[a("code",[t._v("build-module")])]),t._v(" "),a("li",[a("code",[t._v("seal")]),t._v("封装")]),t._v(" "),a("li",[a("code",[t._v("emit")]),t._v("把各个chunk输出到结果（除非特殊设置不然只有一个）")])]),t._v(" "),a("h4",{attrs:{id:"compile-编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compile-编译"}},[t._v("#")]),t._v(" compile 编译")]),t._v(" "),a("p",[t._v("构建了一个Compilation对象实例，里面实现了模块创建，收集依赖关系，分块，打包的任务操作对象")]),t._v(" "),a("h4",{attrs:{id:"make-编译模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#make-编译模块"}},[t._v("#")]),t._v(" make 编译模块")]),t._v(" "),a("p",[t._v("完成Compilation对象实例后，从Entry读取，执行"),a("code",[t._v("_addModuleChain")]),t._v(",即寻找并构筑模块链")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_addModuleChain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("onModule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Dep "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("constructor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" moduleFactory "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dependencyFactories"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Dep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    moduleFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//工厂函数create来生成一个空的NormalModule对象")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("module")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//回调中把module存入compilation.module中和dependecies.module中，")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("afterBuild")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("processModuleDependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("；\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("buildModule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("afterBuild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//随后执行buildModule过程。真正构建模块内容的过程")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("工厂函数create来生成一个空的NormalModule对象")]),t._v(" "),a("li",[t._v("回调中把module存入compilation.module中和dependecies.module中，")]),t._v(" "),a("li",[t._v("随后执行buildModule过程。真正构建模块内容的过程")])]),t._v(" "),a("h4",{attrs:{id:"build-module-模块编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#build-module-模块编译"}},[t._v("#")]),t._v(" build module 模块编译")]),t._v(" "),a("p",[a("code",[t._v("build")]),t._v("即调用配置的loaders，根据文件类型调用不同的loaders将模块加载成标准的JS模块")]),t._v(" "),a("p",[t._v("loaders处理完后，就会使用"),a("code",[t._v("acorn")]),t._v("来解析内容，输出"),a("strong",[t._v("AST（抽象语法树）")]),t._v("。\n对AST的分析逻辑是：\n遇到导入语句时便加入到依赖模块列表，同时根据导入内容对新的依赖模块进行递归分析，最终搞清楚所有模块的依赖关系\n即递归步骤如下：")]),t._v(" "),a("ul",[a("li",[t._v("调用 handleModuleCreate ，根据文件类型构建 module 子类")]),t._v(" "),a("li",[t._v("调用 loader-runner 仓库的 runLoaders 转译 module 内容，通常是从各类资源类型转译为 JavaScript 文本")]),t._v(" "),a("li",[t._v("调用 acorn 将 JS 文本解析为AST")]),t._v(" "),a("li",[t._v("遍历 AST，触发各种钩子")])]),t._v(" "),a("p",[t._v("这个过程中数据流 "),a("code",[t._v("module => ast => dependences => module")]),t._v('，先转 AST 再从 AST 找依赖。这就要求 loaders 处理完的最后结果必须是可以被 acorn 处理的标准 JavaScript 语法，比如说对于图片，需要从图像二进制转换成类似于 export default "data:image/png;base64,xxx" 这类 base64 格式或者 export default "http://xxx" 这类 url 格式。\n按这个流程递归处理，逐步解析出每个模块的内容以及 module 依赖关系，后续就可以根据这些内容打包输出')]),t._v(" "),a("h5",{attrs:{id:"webpack-编译过程会将源码解析为-ast-吗-webpack-与-babel-分别实现了什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-编译过程会将源码解析为-ast-吗-webpack-与-babel-分别实现了什么"}},[t._v("#")]),t._v(" Webpack 编译过程会将源码解析为 AST 吗？webpack 与 babel 分别实现了什么？")]),t._v(" "),a("ul",[a("li",[t._v("构建阶段会读取源码，解析为 AST 集合。")]),t._v(" "),a("li",[t._v("Webpack 读出 AST 之后仅遍历 AST 集合；babel 则对源码做等价转换")])]),t._v(" "),a("h5",{attrs:{id:"webpack-编译过程中-如何识别资源对其他资源的依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-编译过程中-如何识别资源对其他资源的依赖"}},[t._v("#")]),t._v(" Webpack 编译过程中，如何识别资源对其他资源的依赖？")]),t._v(" "),a("ul",[a("li",[t._v("Webpack 遍历 AST 集合过程中，识别 require/ import 之类的导入语句，确定模块对其他资源的依赖关系")])]),t._v(" "),a("h5",{attrs:{id:"相对于-grant、gulp-等流式构建工具-为什么-webpack-会被认为是新一代的构建工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相对于-grant、gulp-等流式构建工具-为什么-webpack-会被认为是新一代的构建工具"}},[t._v("#")]),t._v(" 相对于 grant、gulp 等流式构建工具，为什么 webpack 会被认为是新一代的构建工具？")]),t._v(" "),a("ul",[a("li",[t._v("Grant、Gulp 仅执行开发者预定义的任务流；而 webpack 则深入处理资源的内容，功能上更强大")])]),t._v(" "),a("h3",{attrs:{id:"输出流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#输出流程"}},[t._v("#")]),t._v(" 输出流程")]),t._v(" "),a("h4",{attrs:{id:"seal"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#seal"}},[t._v("#")]),t._v(" seal")]),t._v(" "),a("p",[t._v("原意密封、上锁，我个人理解在 webpack 语境下接近于 “将模块装进蜜罐” ，即封装模块。")]),t._v(" "),a("p",[a("code",[t._v("seal")]),t._v("目的是生成"),a("code",[t._v("Chunks")]),t._v("，并对其进行优化，最终输出网页代码")]),t._v(" "),a("blockquote",[a("p",[t._v("如何理解Chunks：在处理中的Chunks，即配置在Entry中的模块；最终生成的Chunks，即根据前面操作模块的依赖组合组成的包含模块与关系的集合，最后会将Chunks转成单独文件加入到输出")])]),t._v(" "),a("h4",{attrs:{id:"emit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#emit"}},[t._v("#")]),t._v(" emit")]),t._v(" "),a("p",[a("code",[t._v("emit")]),t._v("输出。\n在Chunks最终生成，即主体内容生成完成，知道了“输出什么”，\n会根据configs的"),a("code",[t._v("onput")]),t._v("来确定输出文件的路径等配置，即决定“怎么输出”")]),t._v(" "),a("p",[t._v("emit作为开始生成文件前的钩子会被执行，这是修改最终文件的最后一个机会")]),t._v(" "),a("h3",{attrs:{id:"资源形态流转示意图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资源形态流转示意图"}},[t._v("#")]),t._v(" 资源形态流转示意图")]),t._v(" "),a("p",[a("img",{attrs:{src:s(411),alt:""}})])])}),[],!1,null,null,null);a.default=e.exports}}]);